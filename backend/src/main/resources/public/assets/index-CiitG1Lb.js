import{B as m,F as _,a as E,b as O,E as y,i as $}from"./vendor-DqgDdX21.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(s){if(s.ep)return;s.ep=!0;const r=n(s);fetch(s.href,r)}})();let p=null;function T(e,t,n=5e3){const o=document.createElement("div");o.textContent=t,o.style.cssText=`
        position: absolute;
        top: 10px;
        right: 10px;
        padding: 8px 12px;
        background-color: #333;
        color: #fff;
        border-radius: 4px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        font-family: monospace;
        opacity: 0;
        transition: opacity 0.3s ease;
        z-index: 9999;
    `,e.getParentSvg().parentNode.appendChild(o),requestAnimationFrame(()=>o.style.opacity="1"),setTimeout(()=>{o.style.opacity="0",o.addEventListener("transitionend",()=>o.remove())},n)}function k(e,t){p&&(p.remove(),p=null);const n=document.createElement("div");n.className="help-balloon",n.innerHTML=e,document.body.appendChild(n),p=n;const o=t.getBoundingClientRect(),s=window.scrollX,r=window.scrollY;n.style.left=`${s+o.right+5}px`,n.style.top=`${r+o.top}px`;const a=l=>{p&&p.contains(l.target)||t.contains(l.target)||(p&&(p.remove(),p=null),document.removeEventListener("click",a,!0))};setTimeout(()=>{document.addEventListener("click",a,!0)},0)}function A(e){let t=`
        <h3>${e.command}</h3>
        <p>${e.description}</p>
        <strong>Op√ß√µes dispon√≠veis:</strong>
        <ul style="margin-left:20px; list-style-type:disc;">
    `;for(const n of e.options){const o=n.longFlag?` (${n.longFlag})`:"";t+=`
            <li>
                <strong>${n.flag}</strong>${o}:
                ${n.description}
            </li>
        `}return t+"</ul>"}function u(e){const t=[];for(let n=e;n;n=n.getNextBlock())t.push(n);return t}function S(e,t,n){const o=new Set;for(const s of t){const r=n(s);if(o.has(r)){s.unplug(!0),T(e,`Op√ß√£o "${r}" removida por duplicata`);return}o.add(r)}}function w(e,t,n){for(const o of t)if(!new RegExp(o.regex).test(e))return n.setWarningText(o.errorMessage),null;return n.setWarningText(null),e}function N(e,t){const n={optionsMinMissing:0,operandsMinMissing:0,missingOperands:[]},o=e.getInputTargetBlock("OPTIONS"),s=e.getInputTargetBlock("OPERANDS");if(t.optionsMin!=null){const r=o?u(o):[],a=Math.max(0,t.optionsMin-r.length);n.optionsMinMissing=a}if(t.operandsMin!=null){const r=s?u(s):[],a=Math.max(0,t.operandsMin-r.length);n.operandsMinMissing=a}for(const r of t.operands){const a=`${t.name}_${r.name}_operand`,c=(s?u(s).filter(F=>F.type===a):[]).length,i=r.cardinality?.min??0,f=Math.max(0,i-c);f>0&&n.missingOperands.push({name:r.name,amount:f})}return n}function v(e,t){const n=e.getInputTargetBlock("OPERANDS");if(!n)return;const o=u(n);for(const s of t.operands){const r=s.cardinality?.max;if(typeof r!="number")continue;const a=`${t.name}_${s.name}_operand`,l=o.filter(c=>c.type===a);l.length>r&&(l.slice(r).forEach(c=>c.unplug(!0)),T(e.workspace,`Limite de ${r} excedido para '${s.name}'.`))}}function R(e,t,n){if(!(!n||n.length===0))for(const o of n){const s=t.filter(r=>o.includes(r.getFieldValue("FLAG")));if(s.length>1){const r=s[s.length-1],a=r.getFieldValue("FLAG"),l=s[0].getFieldValue("FLAG");r.unplug(!0),T(e,`Conflito: A op√ß√£o '${a}' n√£o pode ser usada com '${l}'.`);return}}}function L(e,t){const n=B(()=>A(e),30,`Ajuda para ${e.command}`);t.appendDummyInput("HEADER").appendField(e.name).appendField(" ").appendField(n).appendField(X(28),"CARDINALITY_ICON")}function M(e,t){e.options&&e.options.length>0&&t.appendStatementInput("OPTIONS").setCheck(`${e.name}_Option`).appendField("Op√ß√µes:"),e.operands&&e.operands.length>0&&t.appendStatementInput("OPERANDS").setCheck(`${e.name}_Operand`).appendField("Operandos:"),t.setPreviousStatement(!0,"command"),t.setNextStatement(!0,"command"),t.setColour(e.color),t.setTooltip(e.description)}function P(e,t){h(t,()=>{const n=t.getInputTargetBlock("OPTIONS");if(!n)return;const o=u(n).filter(s=>s.type===`${e.name}_option`);S(t.workspace,o,s=>s.getFieldValue("FLAG"))})}function b(e,t){h(t,()=>{const n=N(t,e);J(t,n),v(t,e)})}function V(e,t){!e.exclusiveOptions||e.exclusiveOptions.length===0||h(t,()=>{const n=t.getInputTargetBlock("OPTIONS");if(!n)return;const o=u(n).filter(s=>s.type===`${e.name}_option`);R(t.workspace,o,e.exclusiveOptions)})}function H(e){m[e.name]={init:function(){this.semanticData={nodeType:"command",commandName:e.command},L(e,this),M(e,this),P(e,this),V(e,this),b(e,this)}}}function G(e){const t=e.options.map(o=>{const s=o.longFlag?` | ${o.longFlag}`:"",r=o.description.split(".")[0];return[`${o.flag}${s} (${r})`,o.flag]}),n=new Map(e.options.map(o=>[o.flag,o.description]));return new _(t,function(o){const s=n.get(o);return this.sourceBlock_.setTooltip(s),o})}function W(e,t){const n=G(e),o=B(()=>{const s=t.getFieldValue("FLAG"),r=e.options.find(a=>a.flag===s);return r?r.description:""});t.appendDummyInput("MAIN_INPUT").appendField(`(op√ß√£o de: ${e.command})`,"PARENT_INDICATOR").appendField(" ").appendField(n,"FLAG").appendField(o),t.setPreviousStatement(!0,`${e.name}_Option`),t.setNextStatement(!0,`${e.name}_Option`),t.setColour(e.option_color||e.color)}function Y(e){if(!e.options||e.options.length===0)return;const t=`${e.name}_option`;m[t]={init:function(){this.semanticData={nodeType:"option",relatedCommand:e.command},W(e,this),C(this,e,`(op√ß√£o de: ${e.command})`)}}}function j(e,t){const n=new E(e.defaultValue||"");return n.setValidator(o=>w(o,e.validations,t)),n}function q(e,t,n){const o=j(t,n);n.appendDummyInput("MAIN_INPUT").appendField(`(operando de: ${e.command})`,"PARENT_INDICATOR").appendField(`${t.name}:`).appendField(o,"VALUE"),n.setPreviousStatement(!0,`${e.name}_Operand`),n.setNextStatement(!0,`${e.name}_Operand`),n.setColour(t.color||e.color),n.setTooltip(t.description)}function U(e,t){const n=`${e.name}_${t.name}_operand`;m[n]={init:function(){this.semanticData={nodeType:"operand",operandName:t.name,operandType:t.type,relatedCommand:e.command},q(e,t,this),C(this,e,`(operando de: ${e.command})`)}}}function z(e){if(!(!e.operands||e.operands.length===0))for(const t of e.operands)U(e,t)}function h(e,t){e.__localChangeHandlers||(e.__localChangeHandlers=[],e.setOnChange(()=>{for(const n of e.__localChangeHandlers)try{n(e)}catch(o){console.error("Erro em change-handler:",o)}})),e.__localChangeHandlers.push(t)}const I="/transparent.svg",K="/cardinality_icon.svg";function X(e=28){return new O(I,e,e,"cardinality")}function J(e,t){const n=e.getField("CARDINALITY_ICON");if(!n)return;const{optionsSetMissing:o=0,operandsSetMissing:s=0,missingOperands:r=[]}=t;if(!(o>0||s>0||r.length>0)){e.setWarningText(null),n.setValue(I);return}let l="";if(r.length>0){l+=`Faltam operandos:
`;for(const c of r)l+=` - ${c.name}: precisa de ${c.amount}
`}s>0&&(l+=`Faltam operandos obrigat√≥rios (${s} no m√≠nimo).
`),o>0&&(l+=`Faltam op√ß√µes obrigat√≥rias (${o}).`),e.setWarningText(l),n.setValue(K)}function B(e,t=30,n="?"){const o=new O("/info_icon.svg",t,t,n);return o.setOnClickHandler(()=>{const s=e();if(!s)return;const r=o.getSvgRoot();r&&k(s,r)}),o}function C(e,t,n){h(e,()=>{const o=e.getField("PARENT_INDICATOR");if(!o)return;const s=e.getSurroundParent()?.type===t.name;o.setValue(s?"":n)})}function Q(e){H(e),Y(e),z(e)}function Z(e){return{kind:"category",name:e.name,colour:e.color,contents:[{kind:"block",type:e.name},{kind:"block",type:`${e.name}_option`},...e.operands.map(t=>({kind:"block",type:`${e.name}_${t.name}_operand`}))]}}function D(e,t){return t.map(n=>e.get(n)).filter(Boolean).map(n=>Z(n))}function ee(e){const t=new Map(e.commands.map(n=>[n.command,n]));return{kind:"categoryToolbox",contents:e.categories.map(n=>({kind:"category",name:n.name,contents:D(t,n.commands)}))}}function te(){m.script_root={init:function(){this.appendDummyInput().appendField("üìú Script Principal"),this.appendStatementInput("STACK").setCheck("command"),this.setColour("#333333"),this.setTooltip("Ponto de partida do seu script. Coloque os comandos aqui dentro."),this.setDeletable(!1),this.setMovable(!0)}}}function ne(e){e.addChangeListener(function(t){if(t.type===y.UI||t.type===y.MARKER_MOVE)return;const n=e.getTopBlocks(!1);let o=null;for(const r of n)if(r.type==="script_root"){o=r;break}if(!o)return;const s=e.getAllBlocks(!1);for(const r of s){if(r.isInsertionMarker&&r.isInsertionMarker()||typeof r.setEnabled!="function")continue;if(r===o){r.setEnabled(!0);continue}r.getRootBlock()===o?r.setEnabled(!0):r.setEnabled(!1)}})}function oe(e){const n=e.getTopBlocks(!1).find(s=>s.type==="script_root");if(!n)return null;const o=n.getInputTargetBlock("STACK");return{type:"script",commands:x(o)}}function x(e){const t=[];let n=e;for(;n;)n.isEnabled()&&t.push(re(n)),n=n.getNextBlock();return t}const se=["CARDINALITY_ICON","PARENT_INDICATOR"];function re(e){const t=e.semanticData?{...e.semanticData}:{nodeType:"unknown",rawType:e.type};return t.fields={},t.inputs={},e.inputList.forEach(n=>{n.fieldRow.forEach(o=>{o.name&&o.getValue&&!se.includes(o.name)&&(t.fields[o.name]=o.getValue())})}),e.inputList.forEach(n=>{if(!n.connection)return;const o=n.connection.targetBlock();o?t.inputs[n.name]=x(o):t.inputs[n.name]=[]}),t}const d={blocklyArea:document.getElementById("blockly-area"),codeOutput:document.getElementById("code-output"),cliOutput:document.getElementById("cli-output"),runBtn:document.getElementById("run-btn"),clearBtn:document.getElementById("clear-btn")};let g;function ae(e){return{toolbox:ee(e),renderer:"zelos",trashcan:!0,scrollbars:!0,zoom:{controls:!0,wheel:!0,startScale:.9,maxScale:3,minScale:.3,scaleSpeed:1.2},move:{scrollbars:!0,drag:!0,wheel:!0},grid:{spacing:20,length:3,colour:"#ccc",snap:!0}}}async function le(){te();const e=await fetch("http://localhost:7000/api/definitions");if(!e.ok)throw new Error(`Erro na API: ${e.status} - ${e.statusText}`);const t=await e.json();for(const l of t.commands)Q(l);g=$(d.blocklyArea,ae(t)),ne(g);const n=g.newBlock("script_root");n.initSvg(),n.render(),n.moveBy(50,50);const o=700;let s=0,r=null;async function a(){const l=oe(g);if(!l){d.codeOutput.textContent="// Monte seu script dentro do bloco 'Script Principal'",s=Date.now();return}try{const c=await fetch("http://localhost:7000/api/generate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(!c.ok){d.codeOutput.textContent="// Erro ao gerar script no backend",s=Date.now();return}const i=await c.json();d.codeOutput.textContent=i.script??"// Sem script"}catch{d.codeOutput.textContent="// Falha ao conectar ao backend"}finally{s=Date.now()}}g.addChangeListener(l=>{if(l.type===y.UI)return;const i=Date.now()-s;if(i>=o){r&&(clearTimeout(r),r=null),a();return}if(!r){const f=o-i;r=setTimeout(()=>{r=null,a()},f)}})}le();
